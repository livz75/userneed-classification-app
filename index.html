<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse IA Userneeds - Franceinfo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=12">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <img src="assets/franceinfo.jpg" alt="Franceinfo" class="header-logo">
                Analyse IA des Userneeds
            </h1>
            <div class="header-actions">
                <button id="themeToggle" class="header-btn theme-btn" title="Changer de th√®me">
                    <span class="theme-icon">üåô</span>
                </button>
                <label for="fileInput" class="header-btn upload-btn" title="S√©lectionner un fichier Excel">
                    üìÅ Fichier
                </label>
                <input type="file" id="fileInput" accept=".xlsx" style="display: none;" />
                <button id="resetBtn" class="header-btn reset-btn" title="R√©initialiser" style="display: none;">üîÑ R√©initialiser</button>
                <button id="llmBtn" class="header-btn llm-btn" title="Configuration des mod√®les LLM">ü§ñ LLM</button>
                <button id="settingsBtn" class="header-btn prompts-btn" title="G√©rer les prompts">üìù PROMPTS</button>
                <button id="analyzeBtn" class="header-btn analyze-btn" style="display: none;">Analyse IA</button>
                <button id="stopBtn" class="header-btn stop-btn" style="display: none;">‚èπ Stop</button>
            </div>
        </header>

        <div id="statsContainer" class="stats-container" style="display: none;">
            <div class="confusion-matrix-wrapper">
                <div class="matrix-section">
                    <h3>Matrice de confusion</h3>
                    <div class="confidence-filter-bar" id="confidenceFilterBar">
                        <span class="filter-label">Filtrer par confiance :</span>
                        <button class="confidence-filter-btn active" data-filter="all" onclick="setConfidenceFilter('all')">Tous</button>
                        <button class="confidence-filter-btn" data-filter="haute" onclick="setConfidenceFilter('haute')">Haute</button>
                        <button class="confidence-filter-btn" data-filter="haute+moyenne" onclick="setConfidenceFilter('haute+moyenne')">Haute + Moyenne</button>
                        <button class="confidence-filter-btn" data-filter="basse" onclick="setConfidenceFilter('basse')">Basse</button>
                    </div>
                    <div class="matrix-container">
                        <div class="matrix-with-y-labels">
                            <div class="label-title-y">Cat√©gorie source</div>
                            <div class="matrix-y-with-grid">
                                <div class="matrix-y-labels">
                                    <div class="y-label">Update me</div>
                                    <div class="y-label">Explain me</div>
                                    <div class="y-label">Give me perspective</div>
                                    <div class="y-label">Give me a break</div>
                                    <div class="y-label">Concerning news</div>
                                    <div class="y-label">Inspire me</div>
                                    <div class="y-label">Make me feel</div>
                                    <div class="y-label">Reveal news</div>
                                </div>
                                <div class="matrix-grid-wrapper">
                                    <div id="confusionMatrix" class="matrix-grid"></div>
                                </div>
                            </div>
                        </div>
                        <div class="matrix-x-wrapper">
                            <div class="matrix-x-labels">
                                <div class="x-label">Update me</div>
                                <div class="x-label">Explain me</div>
                                <div class="x-label">Give me perspective</div>
                                <div class="x-label">Give me a break</div>
                                <div class="x-label">Concerning news</div>
                                <div class="x-label">Inspire me</div>
                                <div class="x-label">Make me feel</div>
                                <div class="x-label">Reveal news</div>
                            </div>
                            <div class="label-title-x">Pr√©diction IA</div>
                        </div>
                    </div>
                </div>
                <div class="stats-section">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <h3>Statistiques d√©taill√©es</h3>
                        <button id="exportBtn" class="export-btn" style="margin-top: -5px;">üìä Exporter</button>
                    </div>
                    <div class="stats-box">
                        <div class="stat-title">Total d'articles : <span id="totalArticles">0</span></div>
                        <div class="stat-item">Articles concordants : <span id="concordantCount" class="stat-value-success">0</span> (<span id="concordantPercent" class="stat-value-success">0%</span>)</div>
                        <div class="stat-item">Articles reclassifi√©s : <span id="reclassifiedCount" class="stat-value-error">0</span> (<span id="reclassifiedPercent" class="stat-value-error">0%</span>)</div>
                    </div>
                    <div class="stats-box">
                        <div class="stat-subtitle">Top 5 reclassifications</div>
                        <div id="topReclassifications"></div>
                    </div>
                    <div class="stats-box" id="confidenceStatsBox" style="display: none;">
                        <div class="stat-subtitle">üìä Indice de confiance</div>
                        <div id="confidenceDistribution"></div>
                        <div id="confidencePrecision" style="margin-top: 10px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="fileName" class="file-name" style="text-align: center; margin: 20px 0; display: none;"></div>

        <div id="progress" class="progress-container" style="display: none;">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <p id="progressText" class="progress-text">Analyse en cours...</p>
        </div>

        <div id="tableContainer" class="table-container" style="display: none;">
            <div class="table-header">
                <h2 id="tableTitle">Contenu du fichier</h2>
                <button id="clearBtn" class="clear-btn">Nouveau fichier</button>
            </div>
            <div class="table-wrapper">
                <table id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="error" class="error" style="display: none;"></div>
    </div>

    <!-- Panneau de configuration LLM -->
    <div id="llmPanel" class="llm-panel">
        <div class="llm-panel-backdrop"></div>
        <div class="llm-panel-content">
            <div class="llm-panel-header">
                <h2>ü§ñ Configuration OpenRouter</h2>
                <button id="closeLlmPanelBtn" class="close-panel-btn">‚úï</button>
            </div>

            <div class="provider-config-section">
                <h3>‚öôÔ∏è S√©lection du Mod√®le</h3>

                <div class="form-group">
                    <label for="modelSelect">Choisissez votre mod√®le LLM :</label>
                    <select id="modelSelect" class="model-select">
                        <optgroup label="üü£ Anthropic (via OpenRouter)">
                            <option value="anthropic/claude-3.5-haiku">Claude 3.5 Haiku ‚ö°</option>
                            <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                            <option value="anthropic/claude-3-opus">Claude 3 Opus</option>
                        </optgroup>
                        <optgroup label="üü£ OpenAI (via OpenRouter)">
                            <option value="openai/gpt-4o-mini">GPT-4o Mini ‚ö°</option>
                            <option value="openai/gpt-4o">GPT-4o</option>
                        </optgroup>
                        <optgroup label="üü£ Google (via OpenRouter)">
                            <option value="google/gemini-2.5-flash-lite">Gemini 2.5 Flash Lite ‚ö°‚ö°‚ö°</option>
                            <option value="google/gemini-flash-1.5">Gemini Flash 1.5 ‚ö°‚ö°</option>
                            <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option>
                        </optgroup>
                        <optgroup label="üü£ Meta Llama (via OpenRouter)">
                            <option value="meta-llama/llama-3.1-8b-instruct">Llama 3.1 8B üÜì</option>
                            <option value="meta-llama/llama-3.3-70b-instruct">Llama 3.3 70B</option>
                        </optgroup>
                        <optgroup label="üü£ Mistral AI (via OpenRouter)">
                            <option value="mistralai/mistral-small-24b-instruct-2501">Mistral Small</option>
                            <option value="mistralai/mistral-medium">Mistral Medium</option>
                        </optgroup>
                        <optgroup label="üü£ Alibaba (via OpenRouter)">
                            <option value="qwen/qwen-2.5-72b-instruct">Qwen 2.5 72B</option>
                        </optgroup>
                    </select>
                </div>

                <div class="provider-api-config">
                    <div class="form-group">
                        <label for="openrouterApiKey">Cl√© API OpenRouter :</label>
                        <input type="password" id="openrouterApiKey" class="api-key-input" placeholder="sk-or-...">
                        <p class="input-help-text">Obtenez votre cl√© sur <a href="https://openrouter.ai/keys" target="_blank">openrouter.ai/keys</a></p>
                    </div>
                    <button id="saveProviderConfigBtn" class="btn-save-provider">üíæ Enregistrer la configuration</button>
                </div>

                <p class="provider-help-text">
                    üí° Tous les mod√®les utilisent <strong>OpenRouter</strong> comme provider unifi√©<br>
                    üí° Vous pouvez configurer la cl√© API dans <code>config.json</code> ou la saisir ci-dessus
                </p>

                <div class="reset-config-section">
                    <button id="resetConfigBtn" class="btn-reset-config">
                        üîÑ Recharger depuis config.json
                    </button>
                    <p class="reset-help-text">Rechargez la configuration depuis config.json si vous l'avez modifi√©</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Panneau de gestion des prompts -->
    <div id="promptPanel" class="prompt-panel">
        <div class="prompt-panel-backdrop"></div>
        <div class="prompt-panel-content">
            <div class="prompt-panel-header">
                <h2>üìù Gestion des Prompts</h2>
                <button id="closePanelBtn" class="close-panel-btn">‚úï</button>
            </div>

            <div class="prompt-panel-actions">
                <button id="createPromptBtn" class="action-btn create-btn">
                    <span>‚ûï</span> Nouveau prompt
                </button>
                <button id="importPromptsBtn" class="action-btn import-btn">
                    <span>üì•</span> Importer
                </button>
                <button id="exportPromptsBtn" class="action-btn export-btn">
                    <span>üì§</span> Exporter
                </button>
            </div>

            <div class="prompt-list-container">
                <h3>Prompts disponibles (<span id="promptCount">0</span>)</h3>
                <div id="promptList" class="prompt-list">
                    <!-- Liste g√©n√©r√©e dynamiquement par JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour cr√©er/√©diter un prompt -->
    <div id="promptModal" class="prompt-modal">
        <div class="prompt-modal-backdrop"></div>
        <div class="prompt-modal-content">
            <div class="prompt-modal-header">
                <h2 id="modalTitle">Nouveau prompt</h2>
                <button id="closeModalBtn" class="close-modal-btn">‚úï</button>
            </div>

            <div class="prompt-modal-body">
                <div class="form-group">
                    <label for="promptName">Nom du prompt *</label>
                    <input type="text" id="promptName" placeholder="Ex: Analyse √©ditoriale avanc√©e" maxlength="100">
                </div>

                <div class="form-group">
                    <label for="promptDescription">Description</label>
                    <textarea id="promptDescription" placeholder="Description du prompt..." rows="2" maxlength="500"></textarea>
                </div>

                <div class="form-group">
                    <label for="promptContent">üìù Prompt complet *</label>
                    <textarea id="promptContent" rows="25" placeholder="Collez ici votre prompt complet...

Exemple de structure recommand√©e :

#ROLE
Tu es un expert en...

#VISION DE FRANCEINFO
1. ...
2. ...

#D√âFINITIONS DES USERNEEDS
1. UPDATE ME - ...
2. EXPLAIN ME - ...

#T√ÇCHE
Analyse cet article..."></textarea>
                </div>

                <div class="form-group">
                    <p class="help-text">üí° Vous pouvez structurer votre prompt librement. La section <strong>#ARTICLE √Ä ANALYSER</strong> sera automatiquement ajout√©e lors de l'analyse.</p>
                </div>
            </div>

            <div class="prompt-modal-footer">
                <button id="cancelModalBtn" class="btn-secondary">Annuler</button>
                <button id="savePromptBtn" class="btn-primary">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Input cach√© pour import de fichier -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <!-- Modal pour voir la justification IA -->
    <div id="reasoningModal" class="reasoning-modal">
        <div class="reasoning-modal-backdrop"></div>
        <div class="reasoning-modal-content">
            <div class="reasoning-modal-header">
                <h2>ü§ñ Justification IA</h2>
                <button id="closeReasoningBtn" class="close-modal-btn">‚úï</button>
            </div>
            <div class="reasoning-modal-body">
                <div class="reasoning-result">
                    <div class="reasoning-userneed-badge" id="reasoningUserneedBadge"></div>
                    <div class="reasoning-justification">
                        <h4>Justification:</h4>
                        <p id="reasoningText"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour d√©tails de confiance -->
    <div id="confidenceModal" class="reasoning-modal">
        <div class="reasoning-modal-backdrop"></div>
        <div class="reasoning-modal-content" style="max-width: 500px;">
            <div class="reasoning-modal-header">
                <h2>üìä Indice de Confiance</h2>
                <button id="closeConfidenceBtn" class="close-modal-btn">‚úï</button>
            </div>
            <div class="reasoning-modal-body">
                <div id="confidenceDetail"></div>
            </div>
        </div>
    </div>

    <!-- Toast notification container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js?v=10"></script>
</body>
</html>
